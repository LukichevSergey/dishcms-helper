// rel canonical
if ($APPLICATION->GetPageProperty('is_product_page')) {
    	$url = trim(preg_replace('/^([^?]+)\??.*$/', '$1', $_SERVER['REQUEST_URI']), '/');
    	$canonical = preg_replace('#^catalog/([^/]+)(/?.*)/([^/]+)$#i', 'catalog/$1/$3', $url);
    	if($url != $canonical) {
    		$APPLICATION->AddHeadString('<link href="https://'.$_SERVER['SERVER_NAME'].'/'.$canonical.'/" rel="canonical" />', true);
    	}
    }
